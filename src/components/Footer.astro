---
import { getLangFromUrl, useTranslations, type Lang } from '../lib/i18n';
import { siteConfig, socialIcons, getIconViewBox, type SocialLink } from '../lib/site.config';

interface Props {
  lang?: Lang;
}

const { lang: propLang } = Astro.props;
const lang = propLang || getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const currentYear = new Date().getFullYear();
const startYear = siteConfig.copyrightStartYear || currentYear;
const yearDisplay = startYear === currentYear ? `${currentYear}` : `${startYear}-${currentYear}`;

// Social link labels for accessibility
const socialLabels: Record<SocialLink['type'], { zh: string; en: string }> = {
  github: { zh: 'GitHub', en: 'GitHub' },
  twitter: { zh: 'X (Twitter)', en: 'X (Twitter)' },
  email: { zh: '邮箱', en: 'Email' },
  linkedin: { zh: 'LinkedIn', en: 'LinkedIn' },
  weibo: { zh: '微博', en: 'Weibo' },
  bilibili: { zh: '哔哩哔哩', en: 'Bilibili' },
  youtube: { zh: 'YouTube', en: 'YouTube' },
  instagram: { zh: 'Instagram', en: 'Instagram' },
  website: { zh: '网站', en: 'Website' },
};
---

<footer class="border-t border-primary-100 dark:border-slate-800 mt-auto transition-colors">
  <div class="container-wide py-8">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
      <p class="text-sm text-primary-500 dark:text-slate-500">
        {yearDisplay} {siteConfig.title}. {t('footer.rights')}
      </p>

      <div class="flex items-center gap-4">
        {siteConfig.socialLinks.map((link) => (
          <a
            href={link.url}
            target={link.type === 'email' ? undefined : '_blank'}
            rel={link.type === 'email' ? undefined : 'noopener noreferrer'}
            class="text-primary-400 dark:text-slate-500 hover:text-primary-700 dark:hover:text-white
                   transition-colors p-1.5 rounded-lg hover:bg-primary-50 dark:hover:bg-slate-800"
            aria-label={link.label || socialLabels[link.type]?.[lang] || link.type}
            title={link.label || socialLabels[link.type]?.[lang] || link.type}
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox={getIconViewBox(link.type)}>
              <path d={socialIcons[link.type]} />
            </svg>
          </a>
        ))}
      </div>
    </div>
  </div>
</footer>
