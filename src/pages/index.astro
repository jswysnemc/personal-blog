---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlogCard from '../components/BlogCard.astro';
import { getCollection } from 'astro:content';
import { useTranslations, type Lang } from '../lib/i18n';

export const prerender = true;

export interface Props {
  lang?: Lang;
}

const { lang = 'zh' } = Astro.props;
const t = useTranslations(lang);
const basePath = lang === 'zh' ? '' : `/${lang}`;

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 5);
---

<BaseLayout title={t('nav.home')} description={t('home.description')} lang={lang}>
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <section class="mb-16">
      <h1 class="text-5xl font-bold text-primary-900 mb-6 leading-tight">
        {t('home.welcome')}
      </h1>
      <p class="text-xl text-primary-600 leading-relaxed max-w-2xl">
        {t('home.description')}
      </p>
    </section>

    <section>
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-semibold text-primary-900">{t('home.recentPosts')}</h2>
        <a href={`${basePath}/blog`} class="text-primary-600 hover:text-primary-900 transition-colors">
          {t('home.viewAll')}
        </a>
      </div>

      <div class="space-y-2">
        {posts.map(post => (
          <BlogCard post={post} lang={lang} />
        ))}
      </div>

      {posts.length === 0 && (
        <p class="text-primary-500 text-center py-12">
          {t('home.noPosts')}
        </p>
      )}
    </section>
  </div>
</BaseLayout>
